{"ast":null,"code":"import _regeneratorRuntime from\"/home/radu/Server/src/takserver-tool-ui/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/home/radu/Server/src/takserver-tool-ui/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/home/radu/Server/src/takserver-tool-ui/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import'./UploadFile.css';import React,{useEffect}from'react';import Button from'@mui/material/Button';import TextField from'@mui/material/TextField';import Dialog from'@mui/material/Dialog';import DialogActions from'@mui/material/DialogActions';import DialogContent from'@mui/material/DialogContent';import DialogContentText from'@mui/material/DialogContentText';import DialogTitle from'@mui/material/DialogTitle';import{useTheme}from'@mui/material/styles';import ListItemButton from'@mui/material/ListItemButton';import Box from'@mui/material/Box';import OutlinedInput from'@mui/material/OutlinedInput';import MenuItem from'@mui/material/MenuItem';import Select from'@mui/material/Select';import Chip from'@mui/material/Chip';import Switch from'@mui/material/Switch';import Collapse from'@mui/material/Collapse';import ExpandLess from'@mui/icons-material/ExpandLess';import ExpandMore from'@mui/icons-material/ExpandMore';import Typography from'@mui/material/Typography';import InputLabel from'@mui/material/InputLabel';// Constants to use throughout the component\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var ITEM_HEIGHT=48;var ITEM_PADDING_TOP=8;var MenuProps={PaperProps:{style:{maxHeight:ITEM_HEIGHT*4.5+ITEM_PADDING_TOP,width:350}}};// Structures for missions\nvar allMissions=[];var copMissions=[];function UploadFile(_ref){var _handleUploadAndClose;var openHook=_ref.openHook,setOpenHook=_ref.setOpenHook,deleted=_ref.deleted,setDeleted=_ref.setDeleted,fileProp=_ref.fileProp,setFileProp=_ref.setFileProp,selectedMission=_ref.selectedMission;// Hooks\nvar _React$useState=React.useState([]),_React$useState2=_slicedToArray(_React$useState,2),missions=_React$useState2[0],setMissions=_React$useState2[1];var _React$useState3=React.useState([]),_React$useState4=_slicedToArray(_React$useState3,2),checked=_React$useState4[0],setChecked=_React$useState4[1];var _React$useState5=React.useState(\"\"),_React$useState6=_slicedToArray(_React$useState5,2),resourceName=_React$useState6[0],setResourceName=_React$useState6[1];var _React$useState7=React.useState(\"\"),_React$useState8=_slicedToArray(_React$useState7,2),downloadPath=_React$useState8[0],setDownloadPath=_React$useState8[1];var _React$useState9=React.useState(\"\"),_React$useState10=_slicedToArray(_React$useState9,2),lat=_React$useState10[0],setLat=_React$useState10[1];var _React$useState11=React.useState(\"\"),_React$useState12=_slicedToArray(_React$useState11,2),lon=_React$useState12[0],setLon=_React$useState12[1];var _React$useState13=React.useState(false),_React$useState14=_slicedToArray(_React$useState13,2),openDetails=_React$useState14[0],setOpenDetails=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),copChecked=_React$useState16[0],setCopChecked=_React$useState16[1];var theme=useTheme();// Nedded for hook set timing\nfunction timeout(delay){return new Promise(function(res){return setTimeout(res,delay);});}useEffect(function(){var selectArray=[];if(selectedMission!=null){selectArray.push(selectedMission);setChecked(selectArray);}},[selectedMission]);useEffect(function(){fetch('/Marti/api/missions?passwordProtected=true&defaultRole=true').then(function(response){return response.json();}).then(function(data){var missionList=[];data.data.forEach(function(missionData){missionList.push(missionData.name);allMissions.push(missionData.name);if(missionData.tool===\"vbm\"){copMissions.push(missionData.name);}});setMissions(missionList);});},[openHook]);function handleUploadAndClose(){return(_handleUploadAndClose=_handleUploadAndClose||_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:submitForm();_context.next=3;return timeout(100);case 3:clearData();handleClose();case 5:case\"end\":return _context.stop();}},_callee);}))).apply(this,arguments);};// Needed for dropzone\nfunction getStyles(name,personName,theme){return{fontWeight:personName.indexOf(name)===-1?theme.typography.fontWeightRegular:theme.typography.fontWeightMedium};}var handleClose=function handleClose(){setOpenHook(false);clearData();setCopChecked(false);};var toggleDetails=function toggleDetails(){setOpenDetails(!openDetails);};function clearData(){if(selectedMission!=null){setChecked([selectedMission]);}else{setChecked([]);}setFileProp(\"\");setResourceName(\"\");setDownloadPath(\"\");setLat(\"\");setLon(\"\");setOpenDetails(false);}var handleLeaveOpen=function handleLeaveOpen(){submitForm();clearData();};// Upload function for added file\nfunction submitForm(){var formData=new FormData();formData.append('assetfile',fileProp);formData.append('Name',resourceName);formData.append('DownloadPath',downloadPath);formData.append('Latitude',lat);formData.append('Longitude',lon);fetch('/Marti/sync/upload',{method:\"POST\",body:formData}).then(function(res){if(res.ok){res.json().then(function(data){var missionsLength=checked.length;for(var i=0;i<missionsLength;i++){addMissionContents(data.Hash,checked[i],data.SubmissionUser);}});}},function(e){alert(\"Error submitting form!\");});};// Called when user adds file to mission on upload\nfunction addMissionContents(hash,mission,creatorUid){var data=\"{ \\\"hashes\\\":[ \\\"\"+hash+\"\\\" ] }\";var url='/Marti/api/missions/'+mission+'/contents?creatorUid='+creatorUid;fetch(url,{method:'PUT',headers:{'Content-Type':'application/json'},body:data}).then(function(res){if(!res.ok){console.log(res);}if(res.ok){console.log(\"Upload successful\");setDeleted(!deleted);}});}var handleChange=function handleChange(event){var value=event.target.value;setChecked(// On autofill we get a stringified value.\ntypeof value==='string'?value.split(','):value);};return/*#__PURE__*/_jsxs(Dialog,{open:openHook,fullWidth:true,maxWidth:\"sm\",children:[/*#__PURE__*/_jsxs(DialogContent,{children:[/*#__PURE__*/_jsx(DialogTitle,{sx:{pl:0},children:\"File Upload\"}),/*#__PURE__*/_jsxs(DialogContentText,{children:[fileProp===\"\"?\"No File Selected, drop a file on dialog to upload\":fileProp.name,/*#__PURE__*/_jsx(\"br\",{})]}),/*#__PURE__*/_jsx(DialogTitle,{sx:{pl:0},children:\"Mission\"}),/*#__PURE__*/_jsx(DialogContentText,{children:\"You may optionally associate the file with a mission.\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(Switch,{className:\"copSwitch\",checked:copChecked,onChange:function onChange(e){setCopChecked(e.target.checked);if(e.target.checked===false){setMissions(allMissions);}else{setMissions(copMissions);}},inputProps:{'aria-label':'controlled'}}),/*#__PURE__*/_jsx(Typography,{className:\"copSwitch\",variant:\"body1\",style:{marginRight:16},children:\"Show Only COPs\"})]}),missions.length>0?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(InputLabel,{id:\"mission-chip-label\",children:\"Mission\"}),/*#__PURE__*/_jsx(Select,{style:{width:350},labelId:\"mission-chip-label\",id:\"mission-multiple-chip\",multiple:true,value:checked,onChange:handleChange,input:/*#__PURE__*/_jsx(OutlinedInput,{id:\"select-multiple-chip\",label:\"Chip\"}),renderValue:function renderValue(selected){return/*#__PURE__*/_jsx(Box,{sx:{display:'flex',flexWrap:'wrap',gap:0.5},children:selected.map(function(value){return/*#__PURE__*/_jsx(Chip,{label:value},value);})});},MenuProps:MenuProps,children:missions.map(function(mission){return/*#__PURE__*/_jsx(MenuItem,{value:mission,style:getStyles(mission,missions,theme),children:mission},mission);})})]}):/*#__PURE__*/_jsx(DialogContentText,{children:\"No missions available.\"}),/*#__PURE__*/_jsxs(ListItemButton,{sx:{pl:0},onClick:toggleDetails,children:[\"Optional Settings \",openDetails?/*#__PURE__*/_jsx(ExpandLess,{}):/*#__PURE__*/_jsx(ExpandMore,{})]}),/*#__PURE__*/_jsxs(Collapse,{in:openDetails,children:[/*#__PURE__*/_jsx(TextField,{margin:\"dense\",id:\"name\",value:resourceName,onChange:function onChange(event){return setResourceName(event.target.value);},label:\"Resource Name (Optional)\",fullWidth:true,variant:\"standard\"}),/*#__PURE__*/_jsx(TextField,{margin:\"dense\",id:\"name\",value:downloadPath,onChange:function onChange(event){return setDownloadPath(event.target.value);},label:\"Download Path (Optional)\",fullWidth:true,variant:\"standard\"}),/*#__PURE__*/_jsx(DialogTitle,{sx:{pl:0},children:\"Resource Location\"}),/*#__PURE__*/_jsx(DialogContentText,{children:\"You may enter an optional location to associate with the uploaded resource. For example, if the resource is a photo, the location could represent the place where the photo was taken.\"}),/*#__PURE__*/_jsx(DialogContentText,{children:\"Location is optional but ATAK can only retrieve resources whose location metadata is defined.\"}),/*#__PURE__*/_jsx(TextField,{id:\"lat\",margin:\"dense\",step:\"any\",value:lat,onChange:function onChange(event){return setLat(event.target.value);},error:lat!==\"\"&&(lat<-90||lat>90),helperText:lat!==\"\"&&(lat<-90||lat>90)?'Latitude must be between -90 and 90':'',label:\"Latitude (decimal degrees)\",variant:\"standard\"}),/*#__PURE__*/_jsx(TextField,{margin:\"dense\",step:\"any\",value:lon,onChange:function onChange(event){return setLon(event.target.value);},error:lon!==\"\"&&(lon<-180||lon>180),helperText:lon!==\"\"&&(lon<-180||lon>180)?'Longitude must be between -180 and 180':'',id:\"name\",label:\"Longitude (decimal degrees)\",variant:\"standard\"})]})]}),/*#__PURE__*/_jsxs(DialogActions,{children:[/*#__PURE__*/_jsx(Button,{onClick:handleClose,children:\"Close\"}),/*#__PURE__*/_jsx(Button,{onClick:handleUploadAndClose,disabled:fileProp===\"\",children:\"Upload and Close\"}),/*#__PURE__*/_jsx(Button,{onClick:handleLeaveOpen,disabled:fileProp===\"\",children:\"Upload and Leave Open\"})]})]});}export default UploadFile;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}